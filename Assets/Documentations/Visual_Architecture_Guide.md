# GPU GRASS SYSTEM - VISUAL ARCHITECTURE GUIDE

## SYSTEM ARCHITECTURE DIAGRAMS

### 1. COMPLETE SYSTEM OVERVIEW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           UNITY GAME ENGINE                             â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      CPU SIDE (C# Scripts)                       â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚
â”‚  â”‚  â”‚   Camera     â”‚  â”‚    Chunk     â”‚  â”‚   Density    â”‚          â”‚   â”‚
â”‚  â”‚  â”‚   Manager    â”‚  â”‚   Manager    â”‚  â”‚   Manager    â”‚          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚  â”‚         â”‚                  â”‚                  â”‚                  â”‚   â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚   â”‚
â”‚  â”‚                    â†“                                             â”‚   â”‚
â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚   â”‚
â”‚  â”‚         â”‚  Jobs + Burst (Parallel)â”‚                             â”‚   â”‚
â”‚  â”‚         â”‚  - Blade Generation     â”‚                             â”‚   â”‚
â”‚  â”‚         â”‚  - Parameter Creation   â”‚                             â”‚   â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚   â”‚
â”‚  â”‚                    â†“                                             â”‚   â”‚
â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚   â”‚
â”‚  â”‚         â”‚ BatchRendererGroup (BRG)â”‚                             â”‚   â”‚
â”‚  â”‚         â”‚  - Batch Management     â”‚                             â”‚   â”‚
â”‚  â”‚         â”‚  - Culling Callbacks    â”‚                             â”‚   â”‚
â”‚  â”‚         â”‚  - Buffer Binding       â”‚                             â”‚   â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                       â†“                                               â”‚
â”‚                  [GPU Upload]                                         â”‚
â”‚                  GraphicsBuffer                                       â”‚
â”‚                       â†“                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                GPU SIDE (Shaders)                             â”‚   â”‚
â”‚  â”‚                    â†“                                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚            Structured Buffers (Read-Only)            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  - BladeInstances[instanceID]                        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  - ShapeProfiles[shapeID]                            â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                    â†“                                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚          VERTEX SHADER (Per Vertex)                 â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  1. Read instance data                              â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  2. Evaluate Hermite curve                          â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  3. Compute tangent/normal                          â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  4. Build blade geometry                            â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  5. Sample wind texture                             â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  6. Apply deformation                               â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                    â†“                                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚        FRAGMENT SHADER (Per Pixel)                  â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  1. Compute lighting                                â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  2. Apply translucency                              â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  3. Color variation                                 â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  4. Edge alpha fade                                 â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                    â†“                                           â”‚   â”‚
â”‚  â”‚               [Final Pixels]                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. DATA FLOW (FRAME-BY-FRAME)

```
FRAME N:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CPU EARLY UPDATE (Time: 0ms)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Camera moves to position (100, 0, 50)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Calculate visible chunks:                â”‚
â”‚ Camera chunk: (6, 3)                     â”‚
â”‚ Visible range: (4,1) to (8,5)           â”‚
â”‚                                           â”‚
â”‚ NEW chunks: (7,4), (7,5)                 â”‚
â”‚ OLD chunks: (3,2), (3,3)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Deactivate old chunks:                   â”‚
â”‚ - Remove BRG batch                        â”‚
â”‚ - Dispose GPU buffer                      â”‚
â”‚ - Return to pool                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Schedule Jobs for new chunks:            â”‚
â”‚                                           â”‚
â”‚ Job 1: Generate chunk (7,4)              â”‚
â”‚ Job 2: Generate chunk (7,5)              â”‚
â”‚                                           â”‚
â”‚ [Jobs run in parallel on worker threads] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“

CPU MID UPDATE (Time: ~5ms - Jobs running)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Wait for Jobs to complete...             â”‚
â”‚                                           â”‚
â”‚ Job 1: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 85% complete   â”‚
â”‚ Job 2: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘ 78% complete   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“

CPU LATE UPDATE (Time: ~7ms - Jobs done)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Job 1 Complete:                           â”‚
â”‚   5,000 blade parameters generated        â”‚
â”‚                                           â”‚
â”‚ Job 2 Complete:                           â”‚
â”‚   4,823 blade parameters generated        â”‚
â”‚   (some rejected by density)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Create GraphicsBuffers:                   â”‚
â”‚                                           â”‚
â”‚ Buffer (7,4): 5,000 Ã— 64 bytes = 320 KB  â”‚
â”‚ Buffer (7,5): 4,823 Ã— 64 bytes = 309 KB  â”‚
â”‚                                           â”‚
â”‚ Upload to GPU (SetData):                  â”‚
â”‚ - CPU â†’ GPU memory transfer               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Register with BRG:                        â”‚
â”‚                                           â”‚
â”‚ Batch 47: Chunk (7,4)                     â”‚
â”‚   - Mesh: GrassBlade (shared)             â”‚
â”‚   - Material: GrassMaterial               â”‚
â”‚   - Instances: 5,000                      â”‚
â”‚   - Bounds: (112,0,64) to (128,2,80)     â”‚
â”‚                                           â”‚
â”‚ Batch 48: Chunk (7,5)                     â”‚
â”‚   - Mesh: GrassBlade (shared)             â”‚
â”‚   - Material: GrassMaterial               â”‚
â”‚   - Instances: 4,823                      â”‚
â”‚   - Bounds: (112,0,80) to (128,2,96)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“

RENDER PHASE (Time: Unity decides when)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Unity calls: OnPerformCulling()           â”‚
â”‚                                           â”‚
â”‚ Test each batch:                          â”‚
â”‚ Batch 1 (Chunk 0,0): Outside frustum âœ—   â”‚
â”‚ Batch 2 (Chunk 0,1): Inside frustum âœ“    â”‚
â”‚ ...                                       â”‚
â”‚ Batch 47 (Chunk 7,4): Inside frustum âœ“   â”‚
â”‚ Batch 48 (Chunk 7,5): Inside frustum âœ“   â”‚
â”‚                                           â”‚
â”‚ Result: 18 visible batches                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GPU RENDERING (Parallel)                  â”‚
â”‚                                           â”‚
â”‚ For Batch 47:                             â”‚
â”‚   Instances: 5,000                        â”‚
â”‚   Vertices per instance: 30               â”‚
â”‚   Total vertices: 150,000                 â”‚
â”‚                                           â”‚
â”‚   Vertex Shader executes 150,000 times    â”‚
â”‚   Fragment Shader executes ~500,000 times â”‚
â”‚                                           â”‚
â”‚ [Same for all 18 visible batches]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRAME COMPLETE                            â”‚
â”‚ Total time: ~16ms (60 FPS)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3. BLADE GEOMETRY CONSTRUCTION

```
FROM PARAMETERS TO GEOMETRY:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CPU GENERATES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BladeInstanceData {                â”‚
â”‚   position: (10.5, 0.0, 15.2)     â”‚
â”‚   height: 1.2                      â”‚
â”‚   width: 0.03                      â”‚
â”‚   curvature: 0.35                  â”‚
â”‚   facing: 1.57 (90 degrees)        â”‚
â”‚   ...                              â”‚
â”‚ }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ [Uploaded to GPU]
         â†“

GPU RECEIVES (Vertex Shader):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SV_InstanceID: 42                  â”‚
â”‚ UV: (0.0, 0.0) â† First vertex      â”‚
â”‚                                     â”‚
â”‚ Read: blade = Instances[42]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“

BUILD HERMITE CURVE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ p0 = (10.5, 0.0, 15.2)  â† Root    â”‚
â”‚ p1 = (10.5, 1.2, 15.2)  â† Tip     â”‚
â”‚                                     â”‚
â”‚ m0 = (0.0, 0.6, 0.12)   â† Root    â”‚
â”‚      tangent (up + lean)           â”‚
â”‚                                     â”‚
â”‚ m1 = (0.21, 0.24, 0.0)  â† Tip     â”‚
â”‚      tangent (curved)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“

EVALUATE AT t = 0.0 (Base):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ center = P(0.0) = p0               â”‚
â”‚        = (10.5, 0.0, 15.2)        â”‚
â”‚                                     â”‚
â”‚ tangent = T(0.0)                   â”‚
â”‚         = (0.0, 1.0, 0.2)         â”‚
â”‚         [pointing up + forward]    â”‚
â”‚                                     â”‚
â”‚ side = cross(worldUp, tangent)     â”‚
â”‚      = (1.0, 0.0, 0.0)            â”‚
â”‚      [pointing sideways]           â”‚
â”‚                                     â”‚
â”‚ normal = cross(tangent, side)      â”‚
â”‚        = (0.0, 0.2, -1.0)         â”‚
â”‚        [perpendicular to blade]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“

APPLY WIDTH:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ width = 0.03 Ã— (1-0.0)^1.3        â”‚
â”‚       = 0.03 (full width at base)  â”‚
â”‚                                     â”‚
â”‚ UV.x = 0.0 â†’ side = -1 (left)     â”‚
â”‚                                     â”‚
â”‚ offset = side Ã— width Ã— sideDir    â”‚
â”‚        = (-1) Ã— 0.03 Ã— (1,0,0)    â”‚
â”‚        = (-0.03, 0, 0)             â”‚
â”‚                                     â”‚
â”‚ finalPos = center + offset         â”‚
â”‚          = (10.47, 0.0, 15.2)     â”‚
â”‚          [Left edge of base]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“

SAME PROCESS FOR ALL VERTICES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vertex 0: t=0.0, side=-1 (left)   â”‚
â”‚ Vertex 1: t=0.0, side=+1 (right)  â”‚
â”‚ Vertex 2: t=0.067, side=-1        â”‚
â”‚ Vertex 3: t=0.067, side=+1        â”‚
â”‚ ...                                 â”‚
â”‚ Vertex 28: t=1.0, side=-1 (left)  â”‚
â”‚ Vertex 29: t=1.0, side=+1 (right) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“

RESULT: 30 VERTICES FORMING BLADE
         (15 segments Ã— 2 sides)
```

---

### 4. CHUNK GRID SYSTEM

```
WORLD SPACE VIEW (Top-Down):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

         Chunk Coordinates
    -2    -1     0     1     2     3     4
  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
-2â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚
  â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
-1â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚
  â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
 0â”‚     â”‚     â”‚  C  â”‚  C  â”‚  C  â”‚     â”‚     â”‚  C = Camera can see
  â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
 1â”‚     â”‚     â”‚  C  â”‚  ğŸ¥ â”‚  C  â”‚     â”‚     â”‚  ğŸ¥ = Camera position
  â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
 2â”‚     â”‚     â”‚  C  â”‚  C  â”‚  C  â”‚     â”‚     â”‚
  â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
 3â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚
  â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
 4â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚
  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜

Camera at chunk (1, 1)
View distance = 1 chunk in each direction
Active chunks: 9 (3Ã—3 grid around camera)

As camera moves right:
  New chunks appear on right side
  Old chunks disappear on left side
```

```
CHUNK DETAIL (Single 16Ã—16m chunk):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Chunk (1, 1) - World position (16, 0, 16) to (32, 0, 32)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” (32, 32)
â”‚ â—   â—     â—  â—    â—                  â”‚
â”‚    â—    â—      â—       â—    â—       â”‚  â— = Individual blade
â”‚  â—   â—      â—     â—  â—    â—    â—   â”‚  
â”‚      â—  â—     â—        â—      â—     â”‚  ~5,000 blades total
â”‚ â—      â—   â—     â—  â—      â—       â”‚
â”‚   â—  â—       â—       â—   â—    â—    â”‚
â”‚     â—    â—      â—  â—     â—         â”‚
â”‚ â—        â—   â—          â—   â—  â—   â”‚
â”‚   â—  â—      â—    â—    â—       â—    â”‚
â”‚      â—   â—    â—     â—     â—        â”‚
â”‚ â—     â—       â—  â—     â—      â—    â”‚
â”‚    â—     â—        â—       â—        â”‚
â”‚ â—    â—      â—  â—     â—    â—    â—   â”‚
â”‚      â—   â—        â—    â—      â—    â”‚
â”‚ â—       â—    â—      â—     â—        â”‚
â”‚   â—  â—     â—    â—       â—     â—    â”‚
(16, 16)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Density varies by position:
- High density areas: ~25 blades/mÂ² = ~6,400 blades
- Low density areas: ~10 blades/mÂ² = ~2,560 blades
- Average: ~20 blades/mÂ² = ~5,120 blades
```

---

### 5. BRG BATCH STRUCTURE

```
BATCH RENDERER GROUP ORGANIZATION:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

BatchRendererGroup
â”œâ”€ Batch 0 (Chunk 0,0)
â”‚  â”œâ”€ Mesh: GrassBlade_Template â”€â”€â”€â”€â”
â”‚  â”œâ”€ Material: GrassMaterial â”€â”€â”€â”€â”  â”‚
â”‚  â”œâ”€ Bounds: (0,0,0)â†’(16,2,16)   â”‚  â”‚
â”‚  â””â”€ Instances: 5,247            â”‚  â”‚  } Shared by all batches
â”‚     â””â”€ Buffer: [BladeDataÃ—5247] â”‚  â”‚
â”‚                                  â”‚  â”‚
â”œâ”€ Batch 1 (Chunk 0,1)            â”‚  â”‚
â”‚  â”œâ”€ Mesh: Same â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”œâ”€ Material: Same â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”œâ”€ Bounds: (0,0,16)â†’(16,2,32)
â”‚  â””â”€ Instances: 4,982
â”‚     â””â”€ Buffer: [BladeDataÃ—4982] â† Unique per batch
â”‚
â”œâ”€ Batch 2 (Chunk 1,0)
â”‚  â””â”€ ... (same structure)
â”‚
â””â”€ ... (more batches)

Each batch = ONE draw call
All batches share same mesh and material
Each batch has unique instance buffer
```

```
SINGLE BATCH MEMORY LAYOUT:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

GraphicsBuffer (StructuredBuffer on GPU)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Index 0: BladeInstanceData (64 bytes)                      â”‚
â”‚   position: (16.23, 0.12, 16.84)                           â”‚
â”‚   height: 1.15                                              â”‚
â”‚   width: 0.028                                              â”‚
â”‚   curvature: 0.42                                           â”‚
â”‚   ...                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Index 1: BladeInstanceData (64 bytes)                      â”‚
â”‚   position: (16.87, 0.09, 17.22)                           â”‚
â”‚   height: 0.93                                              â”‚
â”‚   ...                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Index 2: BladeInstanceData (64 bytes)                      â”‚
â”‚   ...                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ... (5,000 total)                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total size: 5,000 Ã— 64 bytes = 320,000 bytes = 320 KB

GPU reads sequentially during draw call:
  Instance 0 â†’ Read index 0
  Instance 1 â†’ Read index 1
  ...
  Instance 4999 â†’ Read index 4999
```

---

### 6. VERTEX SHADER EXECUTION

```
GPU PARALLEL EXECUTION:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

One Blade (Instance 42):
  30 vertices = 30 shader invocations
  All run in parallel on GPU

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vertex 0    â”‚ Vertex 1    â”‚ Vertex 2    â”‚ Vertex 3    â”‚
â”‚ t=0.0       â”‚ t=0.0       â”‚ t=0.067     â”‚ t=0.067     â”‚
â”‚ side=-1     â”‚ side=+1     â”‚ side=-1     â”‚ side=+1     â”‚
â”‚             â”‚             â”‚             â”‚             â”‚
â”‚ Read [42]   â”‚ Read [42]   â”‚ Read [42]   â”‚ Read [42]   â”‚
â”‚ Eval curve  â”‚ Eval curve  â”‚ Eval curve  â”‚ Eval curve  â”‚
â”‚ Build geom  â”‚ Build geom  â”‚ Build geom  â”‚ Build geom  â”‚
â”‚ Apply wind  â”‚ Apply wind  â”‚ Apply wind  â”‚ Apply wind  â”‚
â”‚             â”‚             â”‚             â”‚             â”‚
â”‚ Output â†’    â”‚ Output â†’    â”‚ Output â†’    â”‚ Output â†’    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“             â†“             â†“             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Triangle    â”‚    ...      â”‚ Triangle    â”‚    ...      â”‚
â”‚ Raster      â”‚             â”‚ Raster      â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Multiply this by 5,000 instances:
  5,000 blades Ã— 30 vertices = 150,000 shader invocations
  All running in parallel across GPU cores
```

```
SINGLE VERTEX SHADER EXECUTION FLOW:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

INPUT:
  instanceID = 42
  vertexID = 14
  uv = (0.0, 0.467)  â† From template mesh

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Read Instance Data                                  â”‚
â”‚   blade = BladeInstances[42]                                 â”‚
â”‚   position = (25.3, 0.1, 18.7)                              â”‚
â”‚   height = 1.1                                               â”‚
â”‚   curvature = 0.28                                           â”‚
â”‚   ...                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Extract Parameters                                  â”‚
â”‚   t = uv.y = 0.467 (46.7% up the blade)                    â”‚
â”‚   side = uv.x Ã— 2 - 1 = -1 (left edge)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Build Hermite Curve                                 â”‚
â”‚   p0 = (25.3, 0.1, 18.7)                                    â”‚
â”‚   p1 = (25.3, 1.2, 18.7)                                    â”‚
â”‚   m0 = computed from facing + lean                           â”‚
â”‚   m1 = computed from curvature                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Evaluate Curve                                      â”‚
â”‚   center = HermitePos(p0, p1, m0, m1, 0.467)               â”‚
â”‚          = (25.34, 0.614, 18.82)                            â”‚
â”‚                                                              â”‚
â”‚   tangent = HermiteTan(p0, p1, m0, m1, 0.467)              â”‚
â”‚           = (0.12, 0.95, 0.28)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: Build Frame                                         â”‚
â”‚   T = normalize(tangent) = (0.12, 0.95, 0.28)              â”‚
â”‚   S = cross(up, T) = (0.97, 0, -0.24)                      â”‚
â”‚   N = cross(T, S) = (0.23, -0.29, 0.93)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 6: Apply Width                                         â”‚
â”‚   taper = (1 - 0.467)^1.3 = 0.472                          â”‚
â”‚   width = 0.03 Ã— 0.472 = 0.0142                            â”‚
â”‚   offset = S Ã— side Ã— width                                  â”‚
â”‚          = (0.97, 0, -0.24) Ã— (-1) Ã— 0.0142                â”‚
â”‚          = (-0.0138, 0, 0.0034)                             â”‚
â”‚                                                              â”‚
â”‚   worldPos = center + offset                                 â”‚
â”‚            = (25.326, 0.614, 18.823)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 7: Sample Wind                                         â”‚
â”‚   windUV = worldPos.xz Ã— 0.01 = (0.253, 0.188)             â”‚
â”‚   windData = tex2D(windTex, windUV)                         â”‚
â”‚   windDir = (windData.rg Ã— 2 - 1) = (0.3, 0.2)            â”‚
â”‚   windStr = windData.b = 0.7                                â”‚
â”‚                                                              â”‚
â”‚   phase = time Ã— speed + blade.windPhase                     â”‚
â”‚   sway = sin(phase) = 0.65                                   â”‚
â”‚                                                              â”‚
â”‚   heightFactor = 0.467Â² = 0.218                             â”‚
â”‚   stiffness = blade.stiffness = 0.6                         â”‚
â”‚   bendFactor = 1 - 0.6 = 0.4                                â”‚
â”‚                                                              â”‚
â”‚   windOffset = (0.3, 0, 0.2) Ã— 0.7 Ã— 0.65 Ã— 0.218 Ã— 0.4    â”‚
â”‚              = (0.008, 0, 0.005)                            â”‚
â”‚                                                              â”‚
â”‚   worldPos += windOffset = (25.334, 0.614, 18.828)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 8: Transform to Clip Space                             â”‚
â”‚   clipPos = WorldToClip(worldPos)                           â”‚
â”‚           = ViewProjectionMatrix Ã— worldPos                  â”‚
â”‚           = (screen x, screen y, depth, w)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
OUTPUT:
  positionCS = clipPos
  normalWS = N
  uv = (0.0, 0.467)
  etc.
  â†“
[Sent to Rasterizer â†’ Fragment Shader]
```

---

### 7. WIND TEXTURE SYSTEM

```
WIND TEXTURE GENERATION (Compute Shader):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

512Ã—512 Texture, Updated Each Frame

THREAD GROUPS (8Ã—8 threads each):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TG   TG   TG  ...  TG   TG   TG  â”‚  TG = Thread Group
â”‚  TG   TG   TG  ...  TG   TG   TG  â”‚       (8Ã—8 = 64 threads)
â”‚  TG   TG   TG  ...  TG   TG   TG  â”‚
â”‚  ...  ...  ...  ...  ...  ... ... â”‚  Total: 64Ã—64 = 4,096 groups
â”‚  TG   TG   TG  ...  TG   TG   TG  â”‚       = 262,144 threads
â”‚  TG   TG   TG  ...  TG   TG   TG  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Each thread computes one pixel:

THREAD (256, 128):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ uv = (256/512, 128/512)            â”‚
â”‚    = (0.5, 0.25)                   â”‚
â”‚                                     â”‚
â”‚ offset = time Ã— speed Ã— direction  â”‚
â”‚        = flowing animation          â”‚
â”‚                                     â”‚
â”‚ samplePos = uv + offset            â”‚
â”‚                                     â”‚
â”‚ noise1 = PerlinNoise(samplePosÃ—1)  â”‚
â”‚ noise2 = PerlinNoise(samplePosÃ—2)  â”‚
â”‚ noise3 = PerlinNoise(samplePosÃ—4)  â”‚
â”‚                                     â”‚
â”‚ combined = noise1 + noise2Ã—0.5 +   â”‚
â”‚            noise3Ã—0.25              â”‚
â”‚                                     â”‚
â”‚ angle = combined Ã— 2Ï€               â”‚
â”‚ direction = (sin(angle),cos(angle))â”‚
â”‚ strength = combined                 â”‚
â”‚                                     â”‚
â”‚ Output pixel:                       â”‚
â”‚   R = direction.x Ã— 0.5 + 0.5      â”‚
â”‚   G = direction.y Ã— 0.5 + 0.5      â”‚
â”‚   B = strength                      â”‚
â”‚   A = 1.0                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Result: Flowing, organic wind pattern
```

```
WIND SAMPLING IN VERTEX SHADER:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Blade at world position (45.2, 0, 67.8):

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Calculate UV:                       â”‚
â”‚   uv = worldPos.xz Ã— scale          â”‚
â”‚      = (45.2, 67.8) Ã— 0.01         â”‚
â”‚      = (0.452, 0.678)               â”‚
â”‚                                     â”‚
â”‚ Sample texture:                     â”‚
â”‚   pixel = windTexture[uv]           â”‚
â”‚         = (0.62, 0.48, 0.75, 1.0)  â”‚
â”‚                                     â”‚
â”‚ Decode:                             â”‚
â”‚   dirX = 0.62 Ã— 2 - 1 = 0.24       â”‚
â”‚   dirZ = 0.48 Ã— 2 - 1 = -0.04      â”‚
â”‚   strength = 0.75                   â”‚
â”‚                                     â”‚
â”‚ Wind vector:                        â”‚
â”‚   = (0.24, 0, -0.04) Ã— strength     â”‚
â”‚   = (0.18, 0, -0.03)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Different world positions sample different texture locations
â†’ Spatially varying wind
```

---

### 8. MEMORY LAYOUT

```
SYSTEM MEMORY DISTRIBUTION:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CPU MEMORY (~10 MB):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Chunk Manager: ~1 MB               â”‚
â”‚  - Dictionary of chunks             â”‚
â”‚  - Pools                            â”‚
â”‚  - Temporary arrays                 â”‚
â”‚                                     â”‚
â”‚ Active Chunks (100): ~2 MB          â”‚
â”‚  - Chunk objects                    â”‚
â”‚  - Metadata                         â”‚
â”‚                                     â”‚
â”‚ Jobs System: ~5 MB                  â”‚
â”‚  - NativeArrays (temporary)         â”‚
â”‚  - Job structures                   â”‚
â”‚                                     â”‚
â”‚ Other: ~2 MB                        â”‚
â”‚  - Scripts, managers                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

GPU MEMORY (~55 MB):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Instance Buffers: ~32 MB            â”‚
â”‚  100 chunks Ã— 5,000 blades Ã—        â”‚
â”‚  64 bytes = 32,000,000 bytes        â”‚
â”‚                                     â”‚
â”‚ Template Mesh: ~0.01 MB             â”‚
â”‚  30 vertices Ã— (pos+normal+uv)      â”‚
â”‚  Very small (shared by all)         â”‚
â”‚                                     â”‚
â”‚ Wind Texture: ~1 MB                 â”‚
â”‚  512Ã—512Ã—4 bytes (RGBA float)       â”‚
â”‚                                     â”‚
â”‚ Density Textures: ~16 MB            â”‚
â”‚  100 slices Ã— 64Ã—64 Ã— 4 bytes       â”‚
â”‚                                     â”‚
â”‚ Render Targets: ~6 MB               â”‚
â”‚  Frame buffers, depth, etc.         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TOTAL: ~65 MB
```

---

### 9. PERFORMANCE FLOW

```
FRAME TIMELINE (Target: 16.67ms for 60 FPS):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

0ms  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 16.67ms
     â”‚                                                   â”‚
     â”‚ CPU WORK                                          â”‚
     â”œâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”                â”‚
     â”‚   â”‚         â”‚      â”‚     â”‚     â”‚                 â”‚
     â”‚ Update  Jobs   Wait  Upload BRGâ”‚                 â”‚
     â”‚ 0.5ms  5ms   1ms  0.5ms 0.5ms  â”‚                 â”‚
     â”‚                                 â”‚                 â”‚
     â”‚                                 â†“                 â”‚
     â”‚                          GPU WORK                 â”‚
     â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”          â”‚
     â”‚                          â”‚      â”‚     â”‚          â”‚
     â”‚                        Vertex  Frag  â”‚          â”‚
     â”‚                         5ms   3ms    â”‚          â”‚
     â”‚                                      â”‚          â”‚
     â”‚                                   Display        â”‚
     â”‚                                                   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CPU and GPU work in parallel:
- While GPU renders frame N
- CPU prepares frame N+1
```

---

These diagrams show:
1. How data flows through the system
2. How components connect
3. How parallel processing works
4. How memory is organized
5. How timing works

Use these as mental models when implementing and debugging.
